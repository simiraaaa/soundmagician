/*
 *
 * Label改造
 *
 *
 */


/**
 * @scope enchant.Label.prototype
 */
enchant.Label = enchant.Class.create(enchant.Entity, {
    /**
     * @name enchant.Label
     * @class
     * A class for Label object.
     * @constructs
     * @extends enchant.Entity
     */
    initialize: function(text,x,y) {
        enchant.Entity.call(this);
        this.text = text || '';
        this.width = 300;
        this.fontsize = 'bold 16';
        this.fonttype = 'ＭＳ ゴシック';
        this.font=this.fontsize+" "+this.fonttype;
        this.textAlign = 'left';
        this.color="white";
        this._debugColor = '#ff0000';

        this.x=x===undefined?0:x;
        this.y=y===undefined?0:y;
    },
    /**#nocode+*/
    width: {
        get: function() {
            return this._width;
        },
        set: function(width) {
            this._width = width;
            this._dirty = true;
            // issue #164
            this.updateBoundArea();
        }
    },
    /**#nocode-*/
    /**
     * Text to be displayed.
     * @type String
     */
    text: {
        get: function() {
            return this._text;
        },
        set: function(text) {
            text = '' + text;
            if(this._text === text) {
                return;
            }
            this._text = text;
            text = text.replace(/<(br|BR) ?\/?>/g, '<br/>');
            this._splitText = text.split('<br/>');
            this.updateBoundArea();
            for (var i = 0, l = this._splitText.length; i < l; i++) {
                text = this._splitText[i];
                var metrics = this.getMetrics(text);
                this._splitText[i] = {};
                this._splitText[i].text = text;
                this._splitText[i].height = metrics.height;
            }
        }
    },
    /**
     * Specifies horizontal alignment of text.
     * Can be set according to the format of the CSS 'text-align' property.
     * @type String
     */
    textAlign: {
        get: function() {
            return this._style['text-align'];
        },
        set: function(textAlign) {
            this._style['text-align'] = textAlign;
            this.updateBoundArea();
        }
    },
    /**
     * Font settings.
     * Can be set according to the format of the CSS 'font' property.
     * @type String
     */
    font: {
        get: function() {
            return this._style.font;
        },
        set: function(font) {
            this._style.font = font;
            this.updateBoundArea();
        }
    },

    fontsize: {
        get: function() {
            return this._fontsize;
        },
        set: function(font) {
        	font=font || 14;
            this._fontsize = font+"px";
            this._style.font = this._fontsize+" "+this._fonttype;
            this.updateBoundArea();
        }
    },

    fonttype: {
        get: function() {
            return this._fonttype;
        },
        set: function(font) {
            this._fonttype = font;
            this._style.font = this._fontsize+" "+this._fonttype;
            this.updateBoundArea();
        }
    },
    /**
     * Text color settings.
     * Can be set according to the format of the CSS 'color' property.
     * @type String
     */
    color: {
        get: function() {
            return this._style.color;
        },
        set: function(color) {
            this._style.color = color;
        }
    },
    cvsRender: function(ctx) {
        var x, y = 0;
        var labelWidth = this.width;
        var charWidth, amount, line, text, c, buf, increase, length;
        var bufWidth;
        if (this._splitText) {
            ctx.textBaseline = 'top';
            ctx.font = this.font;
            ctx.fillStyle = this.color || '#000000';
            charWidth = ctx.measureText(' ').width;
            amount = labelWidth / charWidth;
            for (var i = 0, l = this._splitText.length; i < l; i++) {
                line = this._splitText[i];
                text = line.text;
                c = 0;
                while (text.length > c + amount || ctx.measureText(text.slice(c, c + amount)).width > labelWidth) {
                    buf = '';
                    increase = amount;
                    length = 0;
                    while (increase > 0) {
                        if (ctx.measureText(buf).width < labelWidth) {
                            length += increase;
                            buf = text.slice(c, c + length);
                        } else {
                            length -= increase;
                            buf = text.slice(c, c + length);
                        }
                        increase = increase / 2 | 0;
                    }
                    ctx.fillText(buf, 0, y);
                    y += line.height - 1;
                    c += length;
                }
                buf = text.slice(c, c + text.length);
                if (this.textAlign === 'right') {
                    x = labelWidth - ctx.measureText(buf).width;
                } else if (this.textAlign === 'center') {
                    x = (labelWidth - ctx.measureText(buf).width) / 2;
                } else {
                    x = 0;
                }
                ctx.fillText(buf, x, y);
                y += line.height - 1;
            }
        }
    },
    domRender: function(element) {
        if (element.innerHTML !== this._text) {
            element.innerHTML = this._text;
        }
    },
    detectRender: function(ctx) {
        ctx.fillRect(this._boundOffset, 0, this._boundWidth, this._boundHeight);
    },
    updateBoundArea: function() {
        var metrics = this.getMetrics();
        this._boundWidth = metrics.width;
        this._boundHeight = metrics.height;
        if (this.textAlign === 'right') {
            this._boundOffset = this.width - this._boundWidth;
        } else if (this.textAlign === 'center') {
            this._boundOffset = (this.width - this._boundWidth) / 2;
        } else {
            this._boundOffset = 0;
        }
    },
    getMetrics: function(text) {
        var ret = {};
        var div, width, height;
        if (document.body) {
            div = document.createElement('div');
            for (var prop in this._style) {
                if(prop !== 'width' && prop !== 'height') {
                    div.style[prop] = this._style[prop];
                }
            }
            text = text || this._text;
            div.innerHTML = text.replace(/ /g, '&nbsp;');
            div.style.whiteSpace = 'noWrap';
            div.style.lineHeight = 1;
            document.body.appendChild(div);
            ret.height = parseInt(getComputedStyle(div).height, 10) + 1;
            div.style.position = 'absolute';
            ret.width = parseInt(getComputedStyle(div).width, 10) + 1;
            document.body.removeChild(div);
        } else {
            ret.width = this.width;
            ret.height = this.height;
        }
        return ret;
    }
});


/*********/






enchant();

var SPRITE_WIDTH  = ~~320/8;
var SPRITE_HEIGHT = ~~320/3;
var SE_PATH={
		do1:"piano/do1.mp3",
		do1s:"piano/do1s.mp3",
		re:"piano/re.mp3",
		res:"piano/res.mp3",
		mi:"piano/mi.mp3",
		fa:"piano/fa.mp3",
		fas:"piano/fas.mp3",
		so:"piano/so.mp3",
		sos:"piano/sos.mp3",
		ra:"piano/ra.mp3",
		ras:"piano/ras.mp3",
		si:"piano/si.mp3",
		do2:"piano/do2.mp3",
};


var GAKUHU={
		onpa:{
			name:"音波",
			setumei:"無属性:音波を飛ばして敵を攻撃する",
			mp:0,
			power:1,
			magic:function(){
				sentou.mg=this;
				sentou.tl.delay(1).then(function(){
					MessageWindowCt(["音波を飛ばした!",Enemy.damage(this.mg.power)]);
				});
			},
			canField:false,
			canSentou:true,
			s:[0,2,4],
			t:[0,15,30]
		},
		mezame:{
			name:"目覚めの歌",
			setumei:"夢の世界から現実に戻る",
			mp:0,
			magic:function(){scene.tl.delay(1).then(function(){
				if(scene.isDream){
					if(savedata.gakuhu[savedata.gakuhu.length-1]==="mezame")game.replaceScene(MuraScene());
					else MessageWindowCt(["……","何も起こらなかった。","もう少し探索してみよう"]);
				}else{
					MessageWindowCt(["……","どうやらここは現実のようだ。"]);
				}
			})},
			canField:true,
			canSentou:false,
			s:[12,7,5,7,5,0,5,7,12],
			t:[0,8,16,24,32,40,48,55,63]
		},
		kanki:{
			name:"歓喜の歌",
			setumei:"以下の効果を選択。[MP5,HP50%回復]<BR>[MP15,HP全回復]<BR>[MP0,MP50%回復]",
			mp:0,
			magic:function(){},
			canField:false,
			canSentou:true,
			s:[6,6,7,9,9,7,6,4,2,2,4,6,6,4,4,6,6,7,9,9,7,6,4,2,2,4,6,4,2,2],
			t:[0,14,28,41,55,68,82,95,109,124,137,150,163,184,190,217,230,243,255,269,281,294,306,319,333,344,357,370,389,396]
		},
		kirakira:{
			name:"きらきら星",
			setumei:"無属性:以下の効果を選択。[MP3,手裏剣]<BR>[MP30,メテオ]",
			mp:3,
			magic:function(){},
			canField:false,
			canSentou:true,
			power:[3,10],
			s:[0,0,7,7,9,9,7,5,5,4,4,2,2,0,7,7,5,5,4,4,2,7,7,5,5,4,4,2,0,0,7,7,9,9,7,5,5,4,4,2,2,0],
			t:[0,14,27,42,56,70,83,109,123,136,149,161,175,189,217,231,245,258,271,284,298,325,340,352,366,380,394,408,435,450,463,477,491,505,518,544,558,571,584,597,611,624]
		},
		bunbun:{
			name:"ぶんぶんぶん",
			setumei:"無属性:蜂を操り敵を刺しまくる",
			mp:1,
			magic:function(){
				savedata.mp-=this.mp;
				sentou.mg=this;
				sentou.tl.delay(1).then(function(){
					MessageWindowCt(["蜂の大群が"+Enemy.name+"を襲う!",Enemy.damage(this.mg.power)]);
				});

			},
			canField:false,
			canSentou:true,
			power:1.5,
			s:[7,5,4,2,4,5,2,0],
			t:[0,14,28,54,62,69,76,84]
		},
		tengoku:{
			name:"天国と地獄",
			setumei:"火属性:敵を地獄の業火で焼き尽くす。与えたダメージの20%自分のHPを回復する。",
			mp:25,
			type:"hi",
			magic:function(){},
			power:6,
			canField:false,
			canSentou:true,
			s:[0,0,2,5,4,2,7,7,7,9,4,5,2,2,2,5,4,2,0,12,11,9,7,5,4,2,0,0,2,5,4,2,7,7,7,9,4,5,2,2,2,5,4,2,0,7,2,4,0],
			t:[0,11,23,27,33,38,43,54,64,70,74,79,84,95,105,110,116,121,127,133,139,144,149,155,160,166,171,182,192,197,203,208,213,224,235,240,247,251,257,269,278,284,289,295,302,307,314,318,324]
		},
		noroi:{
			name:"呪いの旋律",
			setumei:"以下の効果を選択。[MP10,敵の攻撃力を半分にする]<BR>[MP10,敵の防御力を半分にする]",
			mp:10,
			magic:function(){},
			canField:false,
			canSentou:true,
			s:[1,3,5,4,5,7,5,7,8,7,5,4,1,3,5,4,5,7,5,7,8,12,10,8,8,7,5,4,7,5],
			t:[0,7,13,20,27,34,42,49,56,63,68,76,83,89,96,103,110,116,123,129,136,142,149,156,162,168,174,181,194,202]
		},
		yami:{
			name:"絶望の闇",
			setumei:"闇属性:闇のエネルギーで敵を攻撃。ダメージを与えたあと、敵の防御力を半分にする。",
			mp:15,
			type:"yami",
			power:5,
			magic:function(){},
			canField:false,
			canSentou:true,
			s:[5,0,5,7,8,1,12,1,10,1,8,3,7,8,7,4,0,5],
			t:[0,8,16,25,33,48,53,67,73,87,93,110,115,146,155,163,171,184]
		},
		hikari:{
			name:"希望の光",
			setumei:"光属性:光のエネルギーで敵を攻撃。ダメージを与えたあと、自分の防御力を二倍にする。",
			mp:15,
			power:5,
			type:"hikari",
			magic:function(){},
			canField:false,
			canSentou:true,
			s:[5,0,5,7,5,7,9,10,12,10,9,7,0,5,9,12,4,7,5],
			t:[0,6,11,16,27,32,43,48,54,59,71,77,88,93,98,105,110,122,133]
		},
}

//魔法が発動しているかどうかgakuhusの順番
var isMagicActive=new Array(18);
var fmn=[];
var smn=[];
var i=0;
var gakuhus=[];
for(var k in GAKUHU){
	gakuhus[i]=GAKUHU[k];
	if(GAKUHU[k].canField)fmn[fmn.length]=k;
	if(GAKUHU[k].canSentou)smn[smn.length]=k;
	GAKUHU[k].number=i;
	i++;
}
var savedata={
		name:"フォルテ",
		level:1,
		maxhp:9,
		maxmp:1,
		hp:9,
		mp:1,
		atk:5,
		def:1,
		rateA:1,
		rateD:1,
		isDungeon:false,
		gakuhu:["onpa","kanki","kirakira","tengoku","noroi","yami","hikari"],
		exp:0,
		expTable:1
};


//敵の能力、敵は同時に１体しか相手しない　２体以上なら配列でなんとかなる
var Enemy={
	name:"スライム",
	hp:14,
	atk:5,
	def:20,
	yami:10,
	mizu:150,
	hikari:50,
	hi:1,
	rateA:1,
	rateD:1,
	exp:1,
	set:function(n,h,a,d,ra,rd,ex,AI){
		this.name=n;
		this.hp=h;
		this.atk=a;
		this.def=d;
		this.rateA=ra;
		this.rateD=rd;
		this.exp=ex;
		this.AI=AI;
	},
	damage:function(p,t){
		t=t || "def";
		p=p * savedata.atk * savedata.rateA*(0.8+Math.random()*0.4);
		p=Math.round((1-(this[t]*this.rateD)/100)*p);
		this.hp-=p;
		if(this.hp<=0){
			sentou.tl.delay(1).then(function(){sentou.mst.stack=sentou.mst.stack.concat([Enemy.name+"を倒した！",Enemy.exp+"の経験値を獲得"]);
			savedata.exp+=Enemy.exp;
			while(savedata.exp>=savedata.expTable){
				savedata.level++;
				var h=~~(Math.random()*5+8);
				var m=~~(Math.random()*3+1);
				var a=~~(Math.random()*3+2);
				var d=~~(Math.random()*3);
				savedata.expTable+=savedata.level*savedata.level;
				savedata.maxhp+=h;
				savedata.maxmp+=m;
				savedata.atk+=a;
				savedata.def+=d;
				sentou.mst.stack=sentou.mst.stack.concat(["レベルが"+savedata.level+"に上がった!","HPの最大値が"+h+"上がった! <BR>MPの最大値が"+m+"上がった!","攻撃力が"+a+"上がった! <BR>防御力が"+d+"上がった!"]);

			}
			sentou.mswin.endFunc2=function(){sentou.isEnd=true;}});
		}else {
			sentou.tl.delay(1).then(function(){
				sentou.mst.stack=sentou.mst.stack.concat(["敵の行動１","2"]);

				sentou.mswin.endFunc2=function(){
					sentou.isFight=false;
				}
				});
		}
		if(p>0){
			return this.name+"に"+p+"のダメージ!";
		}else if(p===0){
			return this.name+"の防御力が高くてダメージが通らなかった!";
		}else if(p<0){
			return this.name+"の防御力が高くてダメージが吸収されてしまった！ <BR>"+this.name+"のHPが"+(-p)+"回復した";
		}
	},
	AI:null//１ターンに一回乱数でAI[~~(Math.random()*len)]
}

var ensou=[];
//タイトルシーン
var TitleScene = function(){
	var s=new Scene();
	scene=s;
	s.isDream=true;
    player=Player();
	player.setPosition(10,10);
	map = new Map(16, 16);
	map.image = game.assets['images/map1.png'];
	map.loadData([
	                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
	                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
	                        [0,0,0,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,0,0,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,48,0,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,83,84,84,84,84,84,84,84,84,84,84,84,84,84,84,84,84,84,84,84,84,84,84,84,84,84,84,85,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,99,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,101,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,99,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,101,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,115,100,116,116,116,116,116,116,116,116,116,116,116,116,116,116,116,116,116,116,116,116,116,116,116,116,100,101,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,3,101,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,99,101,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,3,101,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,99,101,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,3,101,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,99,101,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,3,101,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,99,101,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,3,101,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,99,101,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,3,101,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,99,101,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,3,101,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,99,101,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,3,101,3,3,3,3,3,3,3,16,17,17,17,17,17,17,17,17,18,3,3,3,3,3,3,3,99,101,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,3,101,3,3,3,3,3,3,3,32,0,0,0,0,0,0,0,0,34,3,3,3,3,3,3,3,99,100,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,3,101,3,3,3,3,3,3,3,32,0,0,0,0,0,0,0,0,34,3,3,3,3,3,3,3,99,100,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,83,100,85,3,3,3,3,3,3,32,0,0,0,0,0,0,0,0,34,3,3,3,3,3,3,3,99,100,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,99,100,101,3,3,3,3,3,3,32,0,0,0,0,0,0,0,0,34,3,3,3,3,3,3,3,99,100,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,99,100,101,3,3,3,3,3,3,32,0,0,0,0,0,0,0,0,34,3,3,3,3,3,3,3,99,100,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,99,100,101,3,3,3,3,3,3,48,49,49,49,49,49,49,49,49,50,3,3,3,3,3,3,3,99,100,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,99,100,101,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,99,100,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,99,100,101,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,99,100,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,99,100,101,3,3,3,3,3,3,3,3,3,3,3,3,3,3,83,84,84,84,84,84,84,84,84,101,100,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,83,100,100,100,84,84,85,3,3,3,3,3,3,3,3,3,3,3,99,100,100,100,100,100,100,100,100,101,100,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,99,100,100,100,100,100,101,3,3,3,3,3,3,3,3,3,3,3,99,100,100,100,100,100,100,100,100,101,3,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,99,100,100,100,100,100,100,84,84,84,84,84,84,84,84,84,84,84,100,116,116,116,116,116,116,116,116,117,3,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,115,116,116,116,116,116,116,116,116,116,116,116,116,116,116,116,116,116,117,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,1,2,1,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,0,17,17,17,17,18,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,0,49,49,49,0,34,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,32,34,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,32,34,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,32,34,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,32,34,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,32,34,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,32,34,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,32,34,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,34,3,3,3,32,34,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,32,0,0],
	                        [0,0,0,17,17,17,0,0,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,0,0,0],
	                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
	                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
	                    ],[
	                        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,107,-1,-1,-1,-1,-1,107,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,107,-1,-1,-1,-1,-1,107,-1,-1,-1,-1,107,107,107,107,107,107,107,107,107,107,107,107,107,-1,-1,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,-1,-1,107,-1,-1,-1,-1,-1,-1,107,-1,-1,-1,-1,-1,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,107,-1,-1,-1,-1,-1,-1,-1,107,107,107,107,60,61,28,28,107,-1,-1,-1,-1,-1,-1,107,107,107,107,107,107,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,107,-1,-1,-1,-1,-1,-1,107,-1,-1,28,28,76,77,28,28,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,107,-1,-1,-1,-1,-1,-1,107,-1,-1,28,28,28,28,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,107,-1,-1,-1,-1,-1,-1,107,-1,-1,107,107,107,107,107,107,107,107,107,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,107,-1,-1,-1,-1,-1,107,107,-1,107,107,-1,-1,-1,28,28,28,28,-1,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,107,-1,-1,-1,-1,-1,107,-1,-1,107,-1,-1,28,28,28,-1,-1,28,-1,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,107,107,107,107,107,107,-1,-1,-1,107,-1,-1,107,107,107,107,107,28,-1,107,107,107,107,107,107,-1,-1,-1,-1,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,107,-1,-1,-1,-1,107,-1,-1,-1,-1,-1,-1,-1,-1,28,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,107,-1,-1,-1,-1,-1,-1,-1,-1,107,-1,107,107,107,107,107,107,107,107,107,107,107,107,-1,107,-1,-1,-1,-1,107,-1,-1,-1,-1,-1,-1,-1,-1,28,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,107,-1,-1,-1,-1,-1,-1,-1,-1,107,-1,-1,-1,-1,28,-1,-1,-1,-1,-1,-1,-1,107,-1,107,-1,-1,-1,-1,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,107,-1,-1,-1,-1,-1,-1,-1,-1,107,107,107,107,107,107,107,107,107,107,107,107,-1,107,-1,107,-1,-1,-1,-1,107,-1,-1,-1,-1,-1,-1,-1,-1,28,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,107,107,107,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,-1,-1,-1,107,-1,107,-1,-1,-1,-1,107,107,107,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,107,-1,-1,-1,-1,-1,107,107,107,-1,-1,-1,107,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,107,-1,107,-1,-1,-1,-1,-1,-1,-1,107,-1,-1,-1,-1,28,28,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,107,-1,-1,-1,-1,-1,-1,-1,107,107,107,107,-1,-1,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,-1,-1,107,-1,-1,107,-1,-1,-1,-1,28,28,-1,-1,-1,-1,-1,-1],
	                        [-1,28,-1,107,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,107,-1,-1,107,-1,-1,107,-1,-1,-1,-1,-1,28,-1,-1,-1,-1,-1,-1],
	                        [-1,28,-1,-1,-1,107,107,107,107,107,107,107,107,107,107,107,107,107,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,107,-1,-1,107,-1,-1,107,-1,-1,-1,28,28,28,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,12,-1,-1,-1,-1,-1,-1,12,-1,-1,-1,107,-1,-1,107,-1,-1,107,-1,-1,-1,28,28,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,-1,-1,-1,-1,107,-1,-1,-1,107,-1,-1,107,-1,-1,-1,28,28,28,-1,-1,-1,-1,-1,-1],
	                        [-1,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,-1,-1,-1,-1,107,-1,-1,-1,107,-1,-1,107,-1,-1,-1,28,28,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,-1,-1,-1,-1,107,-1,-1,-1,107,-1,-1,107,-1,-1,-1,28,28,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,12,-1,-1,-1,-1,-1,-1,12,-1,-1,107,-1,-1,-1,107,-1,-1,107,-1,-1,28,28,28,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,107,-1,-1,-1,107,-1,-1,107,-1,-1,28,-1,28,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,107,-1,-1,-1,107,-1,-1,107,-1,-1,-1,28,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,107,-1,-1,-1,107,-1,-1,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,107,-1,-1,107,12,12,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,12,12,12,-1,-1,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,12,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,12,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,28,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,12,-1,-1,-1,-1,-1,-1,12,-1,-1,-1,-1,12,-1,-1,-1,-1,-1,-1,28,-1,-1,-1,28,28,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,-1,-1,-1,-1,-1,28,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,12,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,-1,-1,-1,-1,-1,28,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,12,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,28,-1,28,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,-1,28,-1,28,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,12,-1,-1,-1,-1,-1,12,-1,-1,-1,-1,-1,-1,-1,12,-1,-1,-1,-1,-1,28,28,28,28,28,-1,28,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,28,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	                        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]
	                    ]);
	                    map.collisionData = [
	                        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
	                        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
	                        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
	                        [1,1,1,0,0,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],
	                        [1,1,1,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
	                        [1,1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,1,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,1,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,1,0,0,0,0,0,0,1,0,0,0,0,1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,1,0,0,0,0,0,0,1,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,1,0,0,0,0,0,1,1,0,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,1,1,1,1,1,1,0,0,0,1,0,0,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,1,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,1,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,1,0,0,0,0,0,1,1,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,1,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,1,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,1,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,1,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,1,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,1,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	                        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
	                        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
	                        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1]
	                    ];
	var npcs=[];
	npcs[0]=new NPC(25,["あなたの持ってる鍵盤で、そこの宝箱に入ってる楽譜を演奏してみて。","鍵盤は画面の左上をタッチすると使えるよ。あと楽譜は画面の右側の♪をタッチすると見れるよ。"]);
	npcs[0].setPosition(20,30);

	npcs[1]=new Takara("mezame",23,29);
    Grouping([map,npcs[0],npcs[1],player]);
    FieldAdd();
    TouchCtrl();
	MagicActiveAllFalse();
    MessageWindowCt(["ここはどこだろう……。","……とりあえず、抜け出そう。"]);
    s.onenterframe=function(){
    	if(this.isMessage){
    		if(game.input.touch.start)MessageNext();
    	}else{
    		if(game.input.touch.leftupstart)game.pushScene(PianoScene());
    		else if(game.input.touch.rightstart)game.pushScene(GakuhuSelectScene());
    	}
    }
    return s;
};

//村
var MuraScene=function(){
	MagicActiveAllFalse();
	var s=new Scene();
	scene=s;
    player=Player();
	player.setPosition(9,9);
	map = new Map(16, 16);
	map.image = game.assets['images/map1.png'];
	map.loadData([
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],
	    [20,20,20,20,82,82,82,82,82,82,82,69,69,69,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],
	    [20,20,20,20,82,82,7,23,23,23,82,69,69,69,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],
	    [20,20,20,20,82,82,7,82,82,82,82,69,69,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],
	    [20,20,20,20,82,82,7,82,82,82,82,69,69,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],
	    [20,20,20,20,82,82,23,23,23,23,23,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],
	    [20,20,20,20,82,82,82,82,82,82,82,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],
	    [20,20,20,20,82,82,82,82,82,82,82,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,16,17,17,17,17,17,17,17,17,17,17,17,17,18,20,20,20,20,20,97,97,97,97,97,97,97,97,97,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,32,0,49,49,49,49,49,49,49,49,49,49,0,34,20,20,20,20,20,97,97,97,97,97,97,97,97,97,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,32,34,20,20,20,20,20,20,20,20,20,20,32,34,20,20,20,20,20,97,97,97,97,97,97,97,97,97,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,32,34,20,20,20,20,20,20,20,20,20,20,32,34,20,20,20,20,20,97,97,97,97,97,97,97,97,97,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,32,34,37,37,37,37,37,37,37,37,37,37,32,34,37,37,20,20,20,97,97,97,97,97,97,97,97,97,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,32,34,37,37,37,37,37,37,37,37,37,37,32,34,37,37,20,20,20,97,97,97,97,97,97,97,97,97,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,32,34,20,20,20,20,20,20,20,20,20,20,32,34,20,20,20,20,20,97,97,97,97,97,97,97,97,97,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,32,34,20,20,20,20,20,20,20,20,20,20,32,34,20,20,20,20,20,97,97,97,97,97,97,97,97,97,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,32,34,20,20,20,20,20,20,20,20,20,20,32,34,20,20,20,20,20,97,97,97,97,97,97,97,97,97,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,32,34,20,20,20,20,20,20,20,20,20,20,32,34,20,20,20,20,20,97,97,97,97,97,97,97,97,97,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,32,34,20,20,20,20,20,20,20,20,20,20,32,34,20,20,20,20,20,97,97,97,97,97,97,97,97,97,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,32,34,20,20,20,20,20,20,20,20,20,20,32,34,20,20,20,20,20,97,97,97,97,97,97,97,97,97,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,48,50,20,20,20,20,20,20,20,20,20,20,48,50,20,20,20,20,20,97,97,97,97,97,97,97,97,97,97,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,97,97,97,97,97,97,97,97,97,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],
	    [20,20,20,20,66,66,66,66,66,66,66,66,66,66,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],
	    [20,20,20,20,66,66,66,66,66,66,66,66,66,66,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,81,81,81,81,81,81,81,81,81,81,81,81,20,20,20,20,20],
	    [20,20,20,20,66,66,66,66,66,66,66,66,66,66,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,81,81,81,81,81,81,81,81,81,81,81,81,20,20,20,20,20],
	    [20,20,20,20,66,66,66,66,66,66,66,66,66,66,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,81,81,81,81,81,81,81,81,81,81,81,81,20,20,20,20,20],
	    [20,20,20,20,66,66,66,66,66,66,66,66,66,66,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,81,81,81,81,81,81,81,81,81,81,81,81,20,20,20,20,20],
	    [20,20,20,20,66,66,66,66,66,66,66,66,66,66,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,81,81,81,81,81,81,81,81,81,81,81,81,20,20,20,20,20],
	    [20,20,20,20,66,66,66,66,66,66,66,66,66,66,20,20,20,20,20,20,81,81,81,81,81,81,81,81,81,81,81,81,20,81,81,81,81,81,81,81,81,81,81,81,81,20,20,20,20,20],
	    [20,20,20,20,66,66,66,66,66,66,66,66,66,66,20,20,20,20,20,20,81,81,81,81,81,81,81,81,81,81,81,81,20,81,81,81,81,81,81,81,81,81,81,81,81,20,20,20,20,20],
	    [20,20,20,20,66,66,66,66,66,66,66,66,66,66,20,20,20,20,20,20,81,81,81,81,81,81,81,81,81,81,81,81,20,81,81,81,81,81,81,81,81,81,81,81,81,20,20,20,20,20],
	    [20,20,20,20,66,66,66,66,66,66,66,66,66,66,20,20,20,20,20,20,81,81,81,81,81,81,81,81,81,81,81,81,20,81,81,81,81,81,81,81,81,81,81,81,81,20,20,20,20,20],
	    [20,20,20,20,66,66,66,66,66,66,66,66,66,66,20,20,20,20,20,20,81,81,81,81,81,81,81,81,81,81,81,81,20,81,81,81,81,81,81,81,81,81,81,81,81,20,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,81,81,81,81,81,81,81,81,81,81,81,81,20,81,81,81,81,81,81,81,81,81,80,81,81,20,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,81,81,81,81,81,81,81,81,81,81,81,81,20,81,81,81,81,81,81,81,81,81,81,81,81,20,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,81,81,81,81,81,81,81,81,81,81,81,81,20,81,81,81,81,81,81,81,81,81,81,81,81,20,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,81,81,81,81,81,81,81,81,81,81,81,81,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,98,81,81,81,81,81,81,81,81,81,81,81,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],
	    [20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20]
	],[
	    [107,107,107,107,28,107,107,107,107,28,107,107,107,107,28,107,107,107,107,28,107,107,107,107,28,28,107,107,107,107,28,107,107,107,107,28,107,107,107,107,28,107,107,107,107,28,107,107,107,107],
	    [107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107],
	    [107,107,107,7,23,23,23,23,23,23,23,23,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,-1,-1,-1,-1,-1,-1,107,107,107],
	    [107,107,107,7,57,57,57,57,57,57,57,57,57,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,107,107,107],
	    [28,107,107,7,57,57,57,57,57,57,57,57,57,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,-1,107,28,107],
	    [107,107,107,7,57,57,57,57,57,57,57,7,-1,-1,-1,-1,-1,-1,-1,-1,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,107,107,107],
	    [107,107,107,7,57,57,57,13,57,57,57,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,-1,-1,-1,-1,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,-1,-1,-1,-1,107,107,107],
	    [107,107,107,7,57,57,57,57,57,57,57,7,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,107,107,107],
	    [107,107,107,7,57,57,57,57,57,57,57,7,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,107,107,107],
	    [28,107,107,7,57,57,57,57,57,57,57,7,28,-1,-1,-1,-1,-1,-1,-1,-1,60,61,-1,-1,60,61,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,107,28,107],
	    [107,107,107,23,23,23,23,23,23,23,23,23,28,28,28,28,28,28,28,28,28,76,77,60,61,76,77,28,28,28,28,28,28,28,28,28,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,107,107,107],
	    [107,107,107,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,76,77,28,28,28,28,28,28,28,28,28,28,28,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,107,107,107],
	    [107,107,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,107,107,107],
	    [107,107,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,107,107,107],
	    [28,107,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,107,28,107],
	    [107,107,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,28,7,-1,23,23,23,23,23,23,23,7,107,107,107],
	    [107,107,107,28,-1,-1,-1,-1,-1,-1,28,-1,-1,28,28,28,28,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,28,7,-1,-1,-1,-1,-1,-1,121,-1,7,107,107,107],
	    [28,107,107,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,28,-1,-1,60,61,-1,-1,-1,-1,-1,-1,60,61,-1,-1,28,28,28,28,28,7,-1,-1,-1,-1,-1,-1,-1,-1,7,107,107,107],
	    [107,107,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,28,-1,-1,76,77,28,28,28,28,28,28,76,77,-1,-1,28,28,28,28,28,7,-1,-1,-1,-1,-1,-1,121,-1,7,107,107,107],
	    [107,107,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,28,-1,-1,-1,28,28,28,28,28,28,28,28,-1,-1,-1,28,28,28,28,28,7,-1,-1,-1,-1,-1,-1,-1,-1,7,107,28,107],
	    [28,107,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,28,-1,-1,-1,28,28,-1,-1,-1,-1,28,28,-1,-1,-1,28,28,28,28,28,7,-1,-1,-1,-1,-1,-1,-1,-1,7,107,107,107],
	    [107,107,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,28,-1,-1,-1,28,28,-1,-1,-1,-1,28,28,-1,-1,-1,28,28,28,28,28,7,-1,-1,-1,-1,-1,121,-1,-1,7,107,107,107],
	    [107,107,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,28,-1,-1,-1,28,28,-1,-1,-1,-1,28,28,-1,-1,-1,28,28,28,28,28,7,-1,-1,-1,-1,-1,-1,-1,-1,7,107,107,107],
	    [107,107,107,-1,-1,-1,-1,-1,-1,28,-1,-1,-1,28,28,28,28,28,-1,-1,-1,28,28,28,28,28,28,28,28,-1,-1,-1,28,28,28,28,28,7,-1,-1,-1,-1,-1,-1,-1,-1,7,107,107,107],
	    [107,107,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,28,-1,-1,-1,28,28,28,28,28,28,28,28,-1,-1,-1,28,28,28,28,28,7,-1,-1,-1,-1,-1,-1,-1,-1,7,107,28,107],
	    [28,107,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,28,-1,-1,-1,28,28,28,28,28,28,28,28,-1,-1,-1,28,28,28,28,28,7,-1,-1,-1,-1,-1,-1,-1,-1,7,107,107,107],
	    [107,107,107,-1,-1,-1,28,-1,-1,-1,-1,-1,-1,28,28,28,28,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,28,7,-1,-1,-1,-1,-1,-1,-1,-1,7,107,107,107],
	    [107,107,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,28,7,-1,-1,-1,-1,-1,-1,-1,-1,7,107,28,107],
	    [107,107,107,-1,-1,-1,-1,-1,-1,-1,28,-1,-1,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,23,23,7,-1,23,23,23,23,23,23,107,107,107],
	    [107,107,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,-1,-1,7,-1,-1,-1,-1,-1,-1,-1,107,107,107],
	    [28,107,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,-1,-1,23,23,23,23,23,23,7,-1,107,28,107],
	    [107,107,107,-1,7,23,23,23,23,23,-1,-1,-1,7,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,-1,-1,156,156,156,156,156,156,7,-1,107,107,107],
	    [107,107,107,-1,7,-1,-1,-1,-1,-1,-1,-1,-1,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,-1,-1,23,23,23,23,23,23,23,23,23,7,-1,107,107,107],
	    [107,107,107,-1,7,-1,-1,-1,-1,-1,-1,-1,-1,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,-1,-1,-1,-1,-1,156,156,156,156,156,156,7,-1,107,107,107],
	    [107,107,107,-1,7,-1,55,-1,-1,-1,-1,-1,-1,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,-1,-1,-1,-1,-1,156,156,156,156,156,156,7,-1,107,107,107],
	    [28,107,107,-1,7,23,23,23,23,23,-1,-1,-1,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,-1,107,28,107],
	    [107,107,107,-1,7,-1,-1,-1,-1,-1,-1,-1,-1,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,-1,107,107,107],
	    [107,107,107,-1,7,-1,-1,23,23,23,23,23,23,7,23,23,23,23,23,23,23,23,23,23,7,87,87,7,23,23,153,7,-1,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,-1,107,107,107],
	    [107,107,107,-1,7,-1,-1,-1,-1,-1,-1,-1,-1,7,-1,-1,-1,-1,-1,-1,201,-1,-1,-1,7,-1,-1,7,-1,-1,-1,7,-1,7,-1,-1,23,23,23,23,23,7,23,23,23,7,-1,107,107,107],
	    [107,107,107,-1,7,23,23,23,23,23,23,23,-1,7,-1,23,23,23,23,23,7,-1,-1,-1,7,-1,-1,23,-1,-1,-1,7,-1,7,-1,-1,-1,-1,-1,-1,-1,7,-1,-1,-1,7,-1,107,107,107],
	    [28,107,107,-1,7,-1,55,-1,-1,-1,-1,-1,-1,7,-1,-1,-1,-1,-1,-1,7,-1,-1,-1,7,-1,-1,38,38,38,38,7,-1,7,-1,-1,-1,-1,-1,-1,-1,7,-1,-1,-1,7,-1,107,28,107],
	    [107,107,107,-1,7,204,23,23,23,23,23,7,23,23,23,23,23,23,7,-1,7,-1,-1,-1,23,-1,-1,-1,-1,-1,-1,7,-1,7,-1,-1,-1,-1,-1,-1,-1,7,121,-1,-1,7,-1,107,107,107],
	    [107,107,107,-1,7,-1,-1,-1,-1,238,-1,7,-1,-1,-1,28,-1,-1,23,-1,7,38,38,38,38,-1,-1,-1,-1,-1,-1,7,-1,7,-1,-1,-1,-1,-1,121,-1,23,121,-1,-1,7,-1,107,107,107],
	    [107,107,107,-1,7,-1,236,23,23,7,-1,23,-1,-1,23,23,12,23,-1,-1,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,-1,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,28,107,107,107],
	    [107,107,107,-1,7,-1,236,-1,-1,7,-1,-1,-1,7,-1,-1,-1,-1,-1,-1,7,-1,-1,-1,-1,-1,121,-1,-1,-1,-1,7,-1,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,-1,107,107,107],
	    [28,107,107,-1,23,23,23,23,23,23,23,23,23,23,23,23,23,23,7,120,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,23,23,23,23,23,23,23,23,23,23,23,23,23,23,-1,107,28,107],
	    [107,107,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,23,-1,23,23,23,23,23,23,23,23,23,23,23,23,-1,-1,-1,-1,-1,-1,28,-1,-1,-1,-1,-1,-1,-1,-1,107,107,107],
	    [107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,120,120,120,120,120,120,120,120,120,120,120,120,120,120,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107],
	    [107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107,107],
	    [107,107,107,107,28,107,107,107,107,28,107,107,107,107,28,107,107,107,107,28,107,107,107,107,28,107,107,28,107,107,28,107,107,107,107,28,107,107,107,107,28,107,107,107,107,28,107,107,107,107]
	]);
	map.collisionData = [
	    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
	    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
	    [1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	    [1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	    [1,1,1,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	    [1,1,1,1,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	    [1,1,1,1,0,0,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	    [1,1,1,1,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	    [1,1,1,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	    [1,1,1,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	    [1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	    [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	    [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	    [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	    [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	    [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1],
	    [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1,1],
	    [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1,1],
	    [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1,1],
	    [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1,1],
	    [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1,1],
	    [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1,1],
	    [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1,1],
	    [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1,1],
	    [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1,1],
	    [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1,1],
	    [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1,1],
	    [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1,1],
	    [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,1,1,1,1,1,1,1],
	    [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,1,1],
	    [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,1,1,1],
	    [1,1,1,0,1,1,1,1,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1],
	    [1,1,1,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,1,1,1,1,1,1,1,1,0,1,1,1],
	    [1,1,1,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1],
	    [1,1,1,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1],
	    [1,1,1,0,1,1,1,1,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1],
	    [1,1,1,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1],
	    [1,1,1,0,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1],
	    [1,1,1,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,1,1,1,1,1,1,1,1,1,1,0,1,1,1],
	    [1,1,1,0,1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,1,0,0,0,1,0,1,1,1],
	    [1,1,1,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0,1,1,1,1,1,0,1,0,0,0,0,0,0,0,1,0,0,0,1,0,1,1,1],
	    [1,1,1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,0,0,1,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,1,0,0,0,1,0,1,1,1],
	    [1,1,1,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,1,0,0,0,1,0,1,1,1],
	    [1,1,1,0,1,0,0,1,1,1,0,1,0,0,1,1,1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1],
	    [1,1,1,0,1,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1],
	    [1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1],
	    [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
	    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
	    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
	    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
	];

	s.npcs=[
	         new NPC(7,["何か大切なことを忘れているような気がするんだけど……。","気のせいかな？"],24, 5),//うえ
	         new NPC(101,["おまえが持ってるその紙切れ、この前拾ったぞ。","どこにやったか忘れたが、欲しかったらもっていってもいいぞ。"],29,39),//ぶきや
	         new NPC(4,["この村には耳が聞こえない賢者が住んでいるんだけど、最近見てないね。","どこ行ったんだろう。"], 9,19),//左
	         new NPC(34,["井戸がおかしいの。","うめき声みたいな音がするし、水がくめなくて困ってるの。"],24,27),//いどまえ
	         new NPC(10,["ここの北の建物は隣の家の倉庫に繋がってるんだ。","この前、ナイトが何か宝箱に入れているのを見たよ。"],43,40),//右下
	         new Kanban(["井戸"],25,21),
	         new Ido(24,21),
	         new NPC(200,["ぷるぷる、絶対に無くすなって言われてたのになくしちゃったよ～。","あの紙切れがそんなに大事なのかな～？<BR>ん？","あ、それだ！おまえが持ってるやつを探してるんだよ！<BR>よこせ！"],0,0),
	         new Takara("bunbun",22,40)
	         ];
	s.npcs[s.npcs.length-2].visible=false;
	s.npcs[s.npcs.length-2].ef=function(){
		game.pushScene(SentouScene(0,5));
	};
	s.npcs[s.npcs.length-1].ef=function(){
		MessageWindowCt(["モンスタが出たぞーーー！！！！","遠くから声が聞こえる"]);
		var npcs=scene.npcs;
		npcs[0].setPosition(24,18);
		npcs[0].talktext=["モンスターなんて絵本でしか見たことないわ。"];
		npcs[1].setPosition(23,20);
		npcs[1].talktext=["こんな格好をしているが、俺、実は弱いんだ。","代わりに倒してくれよ。頼む！"];
		npcs[3].talktext=["腰が抜けて動けないの。","誰でもいいからそのモンスターを倒して！おねがい！"];
		npcs[4].talktext=["僕はまだ死にたくないから隠れてるよ……。"];
		npcs[npcs.length-2].setPosition(24,23).visible=true;
	}
    Grouping([map,s.npcs,player]);
    FieldAdd();
    TouchCtrl();
    MessageWindowCt(["ん……？","夢か。","あれ？でもさっきの鍵盤と楽譜がある。","まあいいか。"]);
    s.onenterframe=function(){
    	if(this.isMessage){
    		if(game.input.touch.start)MessageNext();
    	}else{
    		if(game.input.touch.leftupstart)game.pushScene(PianoScene());
    		else if(game.input.touch.rightstart)game.pushScene(GakuhuSelectScene());
    	}
    	if(Enemy.hp<=0){
    		this.npcs[0].talktext=["あなたすごいわね！"];
    		this.npcs[1].talktext=["すごすぎるよ、おまえ！<BR>でも、また井戸からモンスターがやってくるかもしれない。","俺の予想ではこの井戸、魔界に繋がってる。","気が向いたらでいいから井戸の中を調べてきてほしい。"];
    		this.npcs[3].talktext=["ありがとう！","でも、まだ腰が抜けて立てないの……"];
    		this.npcs[4].talktext=["僕はまだ死にたくないから隠れてるよ……。","え？もう大丈夫だって？"];
    		this.npcs[2].talktext=["耳が聞こえない賢者はもしかしたら、井戸から魔界に行ったのかも。"];
    		this.npcs[this.npcs.length-2].setPosition(-5,-5);
    	}
    }
    return s;



};





var MagicActiveAllFalse=function(){
	for(var i=0;i<isMagicActive.length;i++)	isMagicActive[i]=0;
};

var MagicActiveSentouFalse=function(){
	for(var i=0;i<gakuhus.length;i++)	{
		if(gakuhus[i].canSentou)isMagicActive[i]=0;
	}
};

var KenbansAllTouchEnd=function(){
	for(var i=0;i<13;i++)Kenbans.n[i].ontouchend();
};

var sentou;
var isSentouScene=false;

//戦闘シーン
var SentouScene=function(id,x,y){
	MagicActiveSentouFalse();
	var s=new Scene();
	isSentouScene=true;
	sentou=s;

	s.addChild(WindowCreator(0,0,320,320));

	s.enemyimage=new EnemyImage(id,x,y);
	s.addChild(s.enemyimage);
	SentouAdd();
    TouchCtrl(s);
    MessageWindowCt([Enemy.name+"が現れた!"]);
    s.onenterframe=function(){
    	if(this.isMessage){
    		if(game.input.touch.start){
    			MessageNext();
    			if(Enemy.hp<=0)this.removeChild(this.enemyimage);
    		}
    	}else if(!this.isFight){
    		if(game.input.touch.rightstart)game.pushScene(GakuhuSelectScene());
    		if(game.input.touch.leftdownstart)game.pushScene(PianoScene());
    	}else if(this.isEnd){
    		isSentouScene=false;
    		savedata.hp=savedata.maxhp;
    		savedata.mp=savedata.maxmp;
    		savedata.rateA=1;
    		savedata.rateD=1;
    		game.popScene();
    	}
    }
    return s;

};

var PianoScene = function(){
	var s=new Scene();
	KenbansAdd(s);
	ModoruCreator(s,160,120);
	if(isSentouScene)SentouMagicList(s);
	else FieldMagicList(s);
    s.on('touchstart',function(e){
    	if(e.y<320/3*2){
    		ensou.length=0;
    		game.popScene();
    	}
    });
    return s;
};
//見ながら演奏
var MinagaraPianoScene = function(i){
	var s=new Scene();
	KenbansAdd(s);
	ModoruCreator(s,160,120);
    s.on('touchstart',function(e){
    	if(e.y<320/3*2){
    		ensou.length=0;
    		KenbansAllTouchEnd();
    		game.popScene();
    	}
    });
	if(isSentouScene)SentouMagicList(s);
	else FieldMagicList(s);
    s.n=savedata.gakuhu[i];
    s.nn=i;
    s.i=0;
    s.el=ensou.length;
    s.onenterframe=function(){
    	if(GAKUHU[this.n].s.length>this.i){

    		Kenbans.n[GAKUHU[this.n].s[this.i]].setRed();

			if(this.el<ensou.length){
				if(ensou[ensou.length-1]===GAKUHU[this.n].s[this.i]){
					this.i++;
					this.el=ensou.length;
				}else{
					this.w=WindowCreator(50,150,200,25);
					this.addChild(this.w);
					this.w.tl.delay(30).removeFromScene();
					this.l=new Label("間違えた！最初からだ！",55,155);
					this.addChild(this.l);
					this.l.tl.delay(30).removeFromScene();
					KenbansAllTouchEnd();
					ensou.length=0;
					this.el=0;
					this.i=0;
				}
			}
    	}
    };
    return s;
};
var AutoPianoScene = function(i){
	var s=new Scene();
	KenbansAdd(s);

	ModoruCreator(s,160,160);
    s.on('touchstart',function(e){
    	if(e.y<SPRITE_HEIGHT*2){
    		KenbansAllTouchEnd();
			ensou.length=0;
			isMagicActive=[].concat(this.copied);
    		game.popScene();
    	}
    });
    s.copied=[].concat(isMagicActive);
    s.c=0;
    s.n=savedata.gakuhu[i];
    s.nn=i;
    s.i=0;
    s.onenterframe=function(){

    	if(this.i>=GAKUHU[this.n].t.length){
    		if(this.c===GAKUHU[this.n].t[this.i-1]+30){
        		KenbansAllTouchEnd();
    			ensou.length=0;
    			isMagicActive=[].concat(this.copied);
    			game.popScene();
    		}
    	}else if(this.c===GAKUHU[this.n].t[this.i]){
    		if(this.i>0){
    			Kenbans.n[GAKUHU[this.n].s[this.i-1]].ontouchend();
    		}
    		Kenbans.n[GAKUHU[this.n].s[this.i]].ontouchstart();
			Kenbans.n[GAKUHU[this.n].s[this.i]].setRed();
    		this.i++;
    	}
    	this.c++;
    };

    return s;
};

var GakuhuSelectScene = function(){
	var s=new Scene();
	TouchCtrl(s);
	var x=15;
	var y=25;
	s.addChild(WindowCreator(x,y,75,50));
	s.addChild(new Label("見ながら<br>演奏",x+5,y+5));

	y=y+106;
	s.addChild(WindowCreator(x,y,75,50));
	s.addChild(new Label("楽譜を<br>見る",x+5,y+5));

	x=320/3;
	y=0;
	s.addChild(WindowCreator(x,y,x,x*2));
	s.addChild(new Label("説明",x+2,y+2));
	s.setumeiLabel=new Label("",x+2,y+22);
	s.setumeiLabel.width=x-20;
	s.addChild(s.setumeiLabel);


	x=x+25;
	y=x*2-15;
	ModoruCreator(s,x,y);

	s.gakuhu=[];
	for(var i=0;i<savedata.gakuhu.length;i++){
		s.gakuhu[i]=new Sprite(108,18);
		s.gakuhu[i].image=new Surface(108,18);
		s.gakuhu[i].x=320/3*2;
		s.gakuhu[i].y=17*i;
		s.gakuhu[i].image.context.fillStyle="black";
		s.gakuhu[0].image.context.fillStyle="#005";
		s.gakuhu[i].image.context.strokeStyle="white";
		RoundRect(s.gakuhu[i].image,0,0,106,17,4,1);
		RoundRect(s.gakuhu[i].image,0,0,106,17,4,0);
		s.gakuhu[i].image.context.fillStyle="white";
		s.gakuhu[i].image.context.textBaseline = 'top';
		s.gakuhu[i].image.context.font="bold 16px 'ＭＳ ゴシック'";
		s.gakuhu[i].image.context.fillText(GAKUHU[savedata.gakuhu[i]].name,0,0,100);
		s.gakuhu[i].number=i;

		s.gakuhu[i].ontouchstart=function(){
			s.gakuhu[s.iti].image.context.fillStyle="black";
			s.gakuhu[s.iti].image.context.strokeStyle="white";
			RoundRect(s.gakuhu[s.iti].image,0,0,106,17,4,1);
			RoundRect(s.gakuhu[s.iti].image,0,0,106,17,4,0);
			s.gakuhu[s.iti].image.context.fillStyle="white";
			s.gakuhu[s.iti].image.context.textBaseline = 'top';
			s.gakuhu[s.iti].image.context.font="bold 16px 'ＭＳ ゴシック'";
			s.gakuhu[s.iti].image.context.fillText(GAKUHU[savedata.gakuhu[s.iti]].name,0,0,100);
			s.iti=this.number;
			s.gakuhu[s.iti].image.context.fillStyle="#000055";
			s.gakuhu[s.iti].image.context.strokeStyle="white";
			RoundRect(s.gakuhu[s.iti].image,0,0,106,17,4,1);
			RoundRect(s.gakuhu[s.iti].image,0,0,106,17,4,0);
			s.gakuhu[s.iti].image.context.fillStyle="white";
			s.gakuhu[s.iti].image.context.textBaseline = 'top';
			s.gakuhu[s.iti].image.context.font="bold 16px 'ＭＳ ゴシック'";
			s.gakuhu[s.iti].image.context.fillText(GAKUHU[savedata.gakuhu[s.iti]].name,0,0,100);
			s.setumeiLabel.text=GAKUHU[savedata.gakuhu[this.number]].name+"<BR>消費MP"+GAKUHU[savedata.gakuhu[this.number]].mp+"<BR>"+GAKUHU[savedata.gakuhu[this.number]].setumei;
		}

		s.addChild(s.gakuhu[i]);

	}
	s.iti=0;
	s.setumeiLabel.text=GAKUHU.onpa.name+"<BR>消費MP"+GAKUHU.onpa.mp+"<BR>"+GAKUHU.onpa.setumei;
	s.onenterframe=function(){
		if(game.input.touch.downstart)game.popScene();
		else if(game.input.touch.leftstart)game.replaceScene(AutoPianoScene(this.iti));
		else if(game.input.touch.leftupstart)game.replaceScene(MinagaraPianoScene(this.iti));
	};

    return s;
};
var FieldMagicList=function(s){
	s.gakuhu=[];
	for(var i=0;i<fmn.length;i++){
		s.gakuhu[i]=new Sprite(108,18);
		s.gakuhu[i].image=new Surface(108,18);
		s.gakuhu[i].x=320/3+~~(i/3)*320/3;
		s.gakuhu[i].y=17*(i%3)*2+~~(i/3)%2*17;
		s.gakuhu[i].image.context.fillStyle="black";
		s.gakuhu[i].image.context.strokeStyle="white";
		RoundRect(s.gakuhu[i].image,0,0,106,17,4,1);
		RoundRect(s.gakuhu[i].image,0,0,106,17,4,0);
		s.gakuhu[i].image.context.fillStyle="white";
		s.gakuhu[i].image.context.textBaseline = 'top';
		s.gakuhu[i].image.context.font="bold 16px 'ＭＳ ゴシック'";
		s.gakuhu[i].image.context.fillText(GAKUHU[fmn[i]].name,0,0,100);
		s.gakuhu[i].name=fmn[i];
		s.gakuhu[i].visible=false;
		s.gakuhu[i].ontouchstart=function(){
			GAKUHU[this.name].magic();
		}
		s.gakuhu[i].onenterframe=function(){
	    	if(game.input.down||game.input.left||game.input.right||game.input.up)this.visible=false;
	    	else if(isMagicActive[GAKUHU[this.name].number]) this.visible=true;
		}
		s.addChild(s.gakuhu[i]);

	}
};
var SentouMagicList=function(s){
	s.gakuhu=[];
	for(var i=0;i<smn.length;i++){
		s.gakuhu[i]=new Sprite(108,18);
		s.gakuhu[i].image=new Surface(108,18);
		s.gakuhu[i].x=~~(i/6)*320/3;
		s.gakuhu[i].y=17*(i%6)*2+~~(i/6)%2*17;
		s.gakuhu[i].image.context.fillStyle="black";
		s.gakuhu[i].image.context.strokeStyle="white";
		RoundRect(s.gakuhu[i].image,0,0,106,17,4,1);
		RoundRect(s.gakuhu[i].image,0,0,106,17,4,0);
		s.gakuhu[i].image.context.fillStyle="white";
		s.gakuhu[i].image.context.textBaseline = 'top';
		s.gakuhu[i].image.context.font="bold 16px 'ＭＳ ゴシック'";
		s.gakuhu[i].image.context.fillText(GAKUHU[smn[i]].name,0,0,100);
		s.gakuhu[i].name=smn[i];
		s.gakuhu[i].visible=false;
		s.gakuhu[i].ontouchstart=function(){
			sentou.isFight=true;
			if(GAKUHU[this.name].mp>savedata.mp){
				sentou.tl.delay(1).then(function(){
					sentou.isFight=false;
					MessageWindowCt(["MPが足りない!"]);
				});
			}else{
				GAKUHU[this.name].magic();
			}
		}
		s.gakuhu[i].onenterframe=function(){
			if(sentou.isFight)this.visible=false;
			else if(isMagicActive[GAKUHU[this.name].number]) this.visible=true;
		}
		s.addChild(s.gakuhu[i]);

	}
};



//
var KenbansAdd=function(s){
	for(var i=0;i<8;i++)s.addChild(Kenbans[Kenbans.name[i]]);
    for(var i=0;i<7;i++)if(Kenbans.names[i])s.addChild(Kenbans[Kenbans.names[i]]);
};

var ModoruCreator=function(s,x,y){
	s.addChild(WindowCreator(x,y,50,30));
	s.addChild(new Label("戻る",x+5,y+5));
};


var Kenbans;
var map;
var game;
var player;
var stage;
var scene;

//状態の定義
var JYOUTAI = {
    Idle : 0,       // 立ち状態
    Walk : 1,       // 歩き状態
    Attack : 2,     // 攻撃状態
    Damaged : 3,    // 被撃状態
    Dead : 4        // 死亡状態
};

//プレイヤー
var Player = enchant.Class.create(Sprite, {
    initialize : function(){
        Sprite.call(this, 32, 32);
        var image = new Surface(96, 128);
        image.draw(game.assets['images/chara0.png'], 0, 0, 96, 128, 0, 0, 96, 128);
        this.image = image;
        this.x = 8;
        this.y = 0;
        this.canWalk = true;

        this.jyoutai = JYOUTAI.Idle;
        this.direction = 0;
        this.animCount = 1;

        this.collideWith = [];
        this.control = true;
    },
    onenterframe : function(){
        var input = { x:0, y:0, d:this.direction };
        if (game.input.up ) {
            input.d = this.control ? 3 : 0;
            input.y = this.control ?-1 : 1;
        } else if (game.input.down) {
            input.d = this.control ? 0 : 3;
            input.y = this.control ? 1 :-1;
        } else if (game.input.left) {
            input.d = this.control ? 1 : 2;
            input.x = this.control ? -1: 1;
        } else if (game.input.right) {
            input.d = this.control ? 2 : 1;
            input.x = this.control ? 1 :-1;
        }
        this.animCount ++;
        switch(this.jyoutai){
            case JYOUTAI.Idle:
                this.frame = this.direction * 3 + 1;
                this.animCount = 0;

                if(this.canWalk){
                    // 移動
                    this.direction = input.d;
                    if (input.x || input.y) {
                        var _x = this.x + input.x * 16;
                        var _y = this.y + input.y * 16;
                        var enemies = this.findEnemies(_x + 16, _y + 24);

                        if (-8 <= _x && _x < map.width && -16 <= _y && _y < map.height &&
                            !map.hitTest(_x + 16, _y + 16) && enemies.length < 1) {
                            this.jyoutai = JYOUTAI.Walk;
                            this.tl.moveTo(_x, _y, 1).then(function(){
                                this.animCount = 0;
                                this.jyoutai = JYOUTAI.Idle;
                            });

                        }
                    }
                }
                break;

            case JYOUTAI.Walk:
                this.frame = this.direction * 3 + (this.animCount % 3);
                break;
        }

    },
    setPosition : function(x, y){
        this.x = x * 16 - 8;
        this.y = y * 16 - 16;
        return this;
    },
    findEnemies : function(x, y){
        var out = [];
        this.collideWith.forEach(function(item){
            if(item.x < x && x < item.x + item.width &&
                item.y < y && y < item.y + item.height){
                out[out.length] = item;
            }
        });
        return out;
    }
});


//敵画像
var EnemyImage = enchant.Class.create(enchant.Sprite, {
  initialize : function(id,x,y){
      enchant.Sprite.call(this, 32, 32);
      var image = new Surface(32, 32);
      image.draw(game.assets['images/chara6.png'], ((id % 9)+0.1) * 32, (~~(id/9)+0.2)*32, 32, 32, 0, 0, 32, 32);
      this.image = image;
      this.x=160;this.y=160;
      if(y!==undefined)this.setScale(x,y);
      else if(x!==undefined)this.setScale(x);
  },
  setScale:function(x,y){
	  this.scaleX=x;
	  if(y===undefined){
		  this.scaleY=x;
	  }else{
		  this.scaleY=y;
	  }
  }
});

//NPC
var NPC = enchant.Class.create(enchant.Sprite, {
  initialize : function(id,text,x,y){
      enchant.Sprite.call(this, 32, 32);
      var image = new Surface(32, 32);
      if(id<100){
      	image.draw(game.assets['images/chara0.png'], (id % 9) * 32, ~~(id/9)*32, 32, 32, 0, 0, 32, 32);
      }else if(id>=100 && id<200){
      	id-=100;
      	image.draw(game.assets['images/chara5.png'], (id % 9) * 32, ~~(id/9)*32, 32, 32, 0, 0, 32, 32);
      }else if(id>=200){
      	id-=200;
      	image.draw(game.assets['images/chara6.png'], (id % 9) * 32, ~~(id/9)*32, 32, 32, 0, 0, 32, 32);
      }
      this.image = image;
      this.talktext=text || ["……。"];
      if(y!==undefined)this.setPosition(x, y);
      player.collideWith.push(this);
  },
  setPosition : function(x, y){
      this.x = x * 16 - 8;
      this.y = y * 16 - 16;
      return this;
  },
  onenterframe : function(){
      if(this.startTalk()){
      	MessageWindowCt(this.talktext);
      	if(this.ef)scene.mswin.endFunc2=this.ef;
      }
  },
  startTalk : function(){
      // プレイヤーが上にいるとき, 右にいるとき, 左にいるとき, 下にいるとき
      return  (player.x == this.x && player.y == this.y - 32 && game.input.down) ||
              (player.x == this.x + 16 && player.y == this.y && game.input.left) ||
              (player.x == this.x - 16 && player.y == this.y && game.input.right) ||
              (player.x == this.x && player.y == this.y + 16 && game.input.up);
  }
});


//宝箱
var Takara = enchant.Class.create(enchant.Sprite, {
    initialize : function(item,x,y){
        enchant.Sprite.call(this, 16, 16);
        var image = new Surface(16, 16);
        image.draw(game.assets['images/map1.png'], 11 * 16, 16, 16, 16, 0, 0, 16, 16);
        this.image = image;
        if(y!==undefined)this.setPosition(x, y);
        this.item=item;
        player.collideWith.push(this);
    },
    setPosition : function(x, y){
        this.x = x * 16 ;
        this.y = y * 16 ;
        return this;
    },
    onenterframe : function(){
    	for(var i=0;i<savedata.gakuhu.length;i++){
    		if(this.item===savedata.gakuhu[i]){
    			player.collideWith.splice(player.collideWith.indexOf(this),1);
    			stage.removeChild(this);
    		}
    	}
        if(this.isItemGet()){
			player.collideWith.splice(player.collideWith.indexOf(this),1);
			MessageWindowCt([GAKUHU[this.item].name+"の楽譜を手に入れた!"]);
			if(this.ef)scene.mswin.endFunc2=this.ef;
			var i=savedata.gakuhu.length;
			savedata.gakuhu[i]=this.item;
			game.pushScene(AutoPianoScene(i));
			stage.removeChild(this);
        }
    },
    isItemGet : function(){
        // プレイヤーが上にいるとき, 右にいるとき, 左にいるとき, 下にいるとき
        return  (player.x == this.x - 8 && player.y == this.y - 32 && game.input.down) ||
                (player.x == this.x + 8 && player.y == this.y - 16 && game.input.left) ||
                (player.x == this.x - 24 && player.y == this.y -16  && game.input.right) ||
                (player.x == this.x - 8 && player.y == this.y  && game.input.up);
    }
});

//看板
var Kanban = enchant.Class.create(enchant.Sprite, {
    initialize : function(text,x,y){
        enchant.Sprite.call(this, 16, 16);
        var image = new Surface(16, 16);
        image.draw(game.assets['images/map1.png'], 11 * 16, 3.5*16, 16, 16, 0, 0, 16, 16);
        this.image = image;
        this.talktext=text || ["……。"];
        if(y!==undefined)this.setPosition(x, y);
        player.collideWith.push(this);
    },
    setPosition : function(x, y){
        this.x = x * 16 ;
        this.y = y * 16 ;
        return this;
    },
    onenterframe : function(){
        if(this.startTalk()){
        	MessageWindowCt(this.talktext);
        }
    },
    startTalk : function(){
    	// プレイヤーが上にいるとき, 右にいるとき, 左にいるとき, 下にいるとき
        return  (player.x == this.x - 8 && player.y == this.y - 32 && game.input.down) ||
                (player.x == this.x + 8 && player.y == this.y - 16 && game.input.left) ||
                (player.x == this.x - 24 && player.y == this.y -16  && game.input.right) ||
                (player.x == this.x - 8 && player.y == this.y  && game.input.up);
    }
});

var Ido = enchant.Class.create(enchant.Sprite, {
    initialize : function(x,y){
        enchant.Sprite.call(this, 16, 16);
        var image = new Surface(16, 16);
        image.draw(game.assets['images/map1.png'], 5 * 16, 12*16, 16, 16, 0, 0, 16, 16);
        this.image = image;
        if(y!==undefined)this.setPosition(x, y);
        player.collideWith.push(this);
    },
    setPosition : function(x, y){
        this.x = x * 16 ;
        this.y = y * 16 ;
        return this;
    },
    onenterframe : function(){
        if(this.startTalk()){
        	if(savedata.gakuhu[savedata.gakuhu.length-1]==="bunbun" && savedata.level>1){
        		MessageWindowCt(["どうやら魔界につながっているらしい","どうする？"]);
        		scene.mswin.endFunc=function(){
        			YesNo("入る","入らない",function(){MessageWindowCt(["開発中のようだ…………"]);},function(){MessageWindowCt(["あとにしよう"]);})
        		};
        	}else{
        		MessageWindowCt(["暗くて様子がわからない"]);
        	}
        }
    },
    startTalk : function(){
    	// プレイヤーが上にいるとき, 右にいるとき, 左にいるとき, 下にいるとき
        return  (player.x == this.x - 8 && player.y == this.y - 32 && game.input.down) ||
                (player.x == this.x + 8 && player.y == this.y - 16 && game.input.left) ||
                (player.x == this.x - 24 && player.y == this.y -16  && game.input.right) ||
                (player.x == this.x - 8 && player.y == this.y  && game.input.up);
    }
});

//はい　いいえ
var YesNo=function(ytext,ntext,yFunc,nFunc){
	var s=scene;
	s.yes=new Sprite(108,21);
	s.yes.image=new Surface(108,21);
	s.yes.x=50;
	s.yes.y=150;
	s.yes.image.context.fillStyle="black";
	s.yes.image.context.strokeStyle="white";
	RoundRect(s.yes.image,0,0,106,17,4,1);
	RoundRect(s.yes.image,0,0,106,17,4,0);
	s.yes.image.context.fillStyle="white";
	s.yes.image.context.textBaseline = 'top';
	s.yes.image.context.font="bold 16px 'ＭＳ ゴシック'";
	s.yes.image.context.fillText(ytext,0,0,100);
	s.yes.Func=yFunc;
	s.yes.ontouchstart=function(){
		this.tl.delay(1).then(function(){
			this.Func();
			scene.removeChild(this.no);
			scene.removeChild(this);
		});
	}
	s.no=new Sprite(108,21);
	s.no.image=new Surface(108,21);
	s.no.x=170;
	s.no.y=150;
	s.no.image.context.fillStyle="black";
	s.no.image.context.strokeStyle="white";
	RoundRect(s.no.image,0,0,106,17,4,1);
	RoundRect(s.no.image,0,0,106,17,4,0);
	s.no.image.context.fillStyle="white";
	s.no.image.context.textBaseline = 'top';
	s.no.image.context.font="bold 16px 'ＭＳ ゴシック'";
	s.no.image.context.fillText(ntext,0,0,100);
	s.no.Func=nFunc;
	s.no.ontouchstart=function(){
		this.tl.delay(1).then(function(){
			this.Func();
			scene.removeChild(this.yes);
			scene.removeChild(this);
		});
	}
	s.no.yes=s.yes;
	s.yes.no=s.no;
	s.addChild(s.no);
	s.addChild(s.yes);
}



//メッセージウィンドウの
var MessageWindowCt=function(text,s){
	if(isSentouScene)s=s || sentou;
	else s=s || scene;
	game.input.touch.start=false;
	s.isMessage=true;
	player.canWalk=false;
	s.mst.stack=text;
	s.mst.text=text[0];
	s.mswin.visible=true;
	s.mscount=0;
};
//メッセージを次に進める.なかったら消す。
var MessageNext=function(s){
	if(isSentouScene)s=s || sentou;
	else s=s || scene;
	s.mscount++;
	if(s.mst.stack.length<=s.mscount){
		s.mst.text="";
		s.mst.stack=null;
		s.mscount=0;
		s.isMessage=false;
		player.canWalk=true;
		s.mswin.visible=false;
		if(s.mswin.endFunc2){
			s.mswin.endFunc2();
			s.mswin.endFunc2=null;
		}

	}else{
		s.mst.text=s.mst.stack[s.mscount];
		if(s.mswin.endFunc&&(s.mst.stack.length<=s.mscount+1)){
			s.mswin.endFunc();
			s.mswin.endFunc=null;
		}
	}
}

//スクロール用にまとめるやつ
var Grouping=function(children,s){
	s=s || scene;
	stage = new Group();
	for(var i=0;i<children.length;i++){
		if(children[i] instanceof Array){
			for(var j=0;j<children[i].length;j++){
				stage.addChild(children[i][j]);
			}
		}else {
			stage.addChild(children[i]);
		}
	}
	stage.onenterframe=Scroll;
    s.addChild(stage);
}

//mapスクロール
var Scroll=function (){
	var x = Math.min((game.width  - 16) / 2 - player.x, 0);
    var y = Math.min((game.height - 16) / 2 - player.y, 0);
    x = Math.max(game.width,  x + map.width)  - map.width;
    y = Math.max(game.height, y + map.height) - map.height;
    stage.x = x;
    stage.y = y;
}

//画面９分割タッチイベント
var TouchCtrl=function(s){

	if(isSentouScene)s=s || sentou;
	else s=s || scene;

	s.on('touchstart',function(e){
		game.input.touch.start   =true;
		var size=320/3;
		if(e.x <size){
			if(e.y <size){
				game.input.touch.leftupstart=true;
				game.input.touch.leftup=true;
			}else if(e.y <size*2){
				game.input.touch.leftstart=true;
				game.input.touch.left=true;
			}else{
				game.input.touch.leftdownstart=true;
				game.input.touch.leftdown=true;
			}
		}else if(e.x < size*2){
			if(e.y <size){
				game.input.touch.upstart=true;
				game.input.touch.up=true;
			}else if(e.y <size*2){
				game.input.touch.centerstart=true;
				game.input.touch.center=true;
			}else{
				game.input.touch.downstart=true;
				game.input.touch.down=true;
			}
		}else{
			if(e.y <size){
				game.input.touch.rightupstart=true;
				game.input.touch.rightup=true;
			}else if(e.y <size*2){
				game.input.touch.rightstart=true;
				game.input.touch.right=true;
			}else{
				game.input.touch.rightdownstart=true;
				game.input.touch.rightdown=true;
			}
		}
	});
	s.on('touchmove',function(e){
		var size=320/3;
		game.input.touch.leftup   =false;
		game.input.touch.up       =false;
		game.input.touch.rightup  =false;
		game.input.touch.left     =false;
		game.input.touch.center   =false;
		game.input.touch.right    =false;
		game.input.touch.leftdown =false;
		game.input.touch.down     =false;
		game.input.touch.rightdown=false;
		if(e.x <size){
			if(e.y <size){
				game.input.touch.leftup=true;
			}else if(e.y <size*2){
				game.input.touch.left=true;
			}else{
				game.input.touch.leftdown=true;
			}
		}else if(e.x < size*2){
			if(e.y <size){
				game.input.touch.up=true;
			}else if(e.y <size*2){
				game.input.touch.center=true;
			}else{
				game.input.touch.down=true;
			}
		}else{
			if(e.y <size){
				game.input.touch.rightup=true;
			}else if(e.y <size*2){
				game.input.touch.right=true;
			}else{
				game.input.touch.rightdown=true;
			}
		}
	});
	s.on('touchend',function(){
		game.input.touch.leftup   =false;
		game.input.touch.up       =false;
		game.input.touch.rightup  =false;
		game.input.touch.left     =false;
		game.input.touch.center   =false;
		game.input.touch.right    =false;
		game.input.touch.leftdown =false;
		game.input.touch.down     =false;
		game.input.touch.rightdown=false;
	});
}

//フィールドのシーンに追加するような奴
var FieldAdd=function(s){
	s=s || scene;
	var pad = new Pad();
    pad.x = 5;
    pad.y = 215;
    s.addChild(pad);




    s.stwin=WindowCreator(320/3*2+30,320/3+30,78,78);
    s.stwin.label=new Label("HP:"+savedata.hp+"<BR> <BR> <BR>MP:"+savedata.mp,s.stwin.x+5,s.stwin.y+7);
    s.stwin.onenterframe=function(){
    	if(game.input.down||game.input.left||game.input.right||game.input.up){
    		this.visible=false;
    		this.label.visible=false;
    	}else{
    		this.visible=true;
    		this.label.visible=true;
        	this.label.text="HP:"+savedata.hp+"<BR> <BR> <BR>MP:"+savedata.mp;
    	}
    };
    s.addChild(s.stwin);
    s.addChild(s.stwin.label);


    s.minigakuhu=new Sprite(30,30);
    s.minigakuhu.image=new Surface(30,30);
    s.minigakuhu.image.context.fillStyle="white";
    RoundRect(s.minigakuhu.image, 0, 0, 29, 29, 10, 1);
    RoundRect(s.minigakuhu.image, 0, 0, 29, 29, 10, 0);
    s.minigakuhu.image.context.fillStyle="black";
    s.minigakuhu.image.context.font="bold 24px 'ＭＳ ゴシック'";
    s.minigakuhu.image.context.fillText("♪",2,23);
    s.minigakuhu.x=320-50;
    s.minigakuhu.y=160;
    s.minigakuhu.onenterframe=function(){
    	if(game.input.down||game.input.left||game.input.right||game.input.up)this.visible=false;
    	else this.visible=true;
    };
    s.addChild(s.minigakuhu);

    s.miniken=new Sprite(30,30);
    s.miniken.image=new Surface(30,30);
    for(var i=0;i<3;i++){
    	s.miniken.image.context.fillStyle="white";
    	s.miniken.image.context.fillRect(i*9,0,9,29);
    	s.miniken.image.context.strokeRect(i*9,0,9,29);
    }
    for(var i=0;i<2;i++){
    	s.miniken.image.context.fillStyle="black";
    	s.miniken.image.context.fillRect(i*9+5,0,7,15);
    }
    s.miniken.x=50;
    s.miniken.y=50;
    s.miniken.onenterframe=function(){
    	if(game.input.down||game.input.left||game.input.right||game.input.up)this.visible=false;
    	else this.visible=true;
    };
    s.addChild(s.miniken);

    s.mswin=WindowCreator(0,320-111,320,110);
    s.addChild(s.mswin);
    s.mswin.visible=false;
    s.mscount=0;
    s.mst=new Label();
    s.mst.width=300;
    s.mst.x=5;
    s.mst.y=320-105;
    s.addChild(s.mst);

    FieldMagicList(s);
};


//戦闘シーンに追加するような奴
var SentouAdd=function(s){
	s=s || sentou;
//	var pad = new Pad();
//	  pad.x = 5;
//	  pad.y = 215;
//	  s.addChild(pad);




  s.stwin=WindowCreator(320/3*2+30,320/3+30,78,78);
  s.stwin.label=new Label("HP:"+savedata.hp+"<BR> <BR> <BR>MP:"+savedata.mp,s.stwin.x+5,s.stwin.y+7);
  s.stwin.onenterframe=function(){
      	this.label.text="HP:"+savedata.hp+"<BR> <BR> <BR>MP:"+savedata.mp;
  };
  s.addChild(s.stwin);
  s.addChild(s.stwin.label);


  s.minigakuhu=new Sprite(30,30);
  s.minigakuhu.image=new Surface(30,30);
  s.minigakuhu.image.context.fillStyle="white";
  RoundRect(s.minigakuhu.image, 0, 0, 29, 29, 10, 1);
  RoundRect(s.minigakuhu.image, 0, 0, 29, 29, 10, 0);
  s.minigakuhu.image.context.fillStyle="black";
  s.minigakuhu.image.context.font="bold 24px 'ＭＳ ゴシック'";
  s.minigakuhu.image.context.fillText("♪",2,23);
  s.minigakuhu.x=320-50;
  s.minigakuhu.y=160;

  s.addChild(s.minigakuhu);

  s.miniken=new Sprite(30,30);
  s.miniken.image=new Surface(30,30);
  for(var i=0;i<3;i++){
  	s.miniken.image.context.fillStyle="white";
  	s.miniken.image.context.fillRect(i*9,0,9,29);
  	s.miniken.image.context.strokeRect(i*9,0,9,29);
  }
  for(var i=0;i<2;i++){
  	s.miniken.image.context.fillStyle="black";
  	s.miniken.image.context.fillRect(i*9+5,0,7,15);
  }
  s.miniken.x=50;
  s.miniken.y=270;
  s.addChild(s.miniken);


  s.mswin=WindowCreator(0,320-111,320,110);
  s.addChild(s.mswin);
  s.mswin.visible=false;
  s.mscount=0;
  s.mst=new Label();
  s.mst.width=300;
  s.mst.x=5;
  s.mst.y=320-105;
  s.addChild(s.mst);

  SentouMagicList(s);
};



//枠を作る
var WindowCreator=function(x,y,width,height){
	c=new Sprite(width+1,height+1);
    c.image=new Surface(width+10,height+10);
    c.x=x;
    c.y=y;
    c.image.context.fillStyle="black";
    c.image.context.strokeStyle="white";
    c.image.context.lineWidth=3;
    RoundRect(c.image, 0, 0, width, height, 10, 1);
    RoundRect(c.image, 0, 0, width, height, 10, 0);
    return c;
};

//角丸
var RoundRect= function(canvas, x, y, width, height, radius, isFill) {
    var l = x + radius;
    var r = x + width - radius;
    var t = y + radius;
    var b = y + height - radius;

    canvas.context.beginPath();
    canvas.context.arc(l, t, radius,     -Math.PI, -Math.PI*0.5, false);  // 左上
    canvas.context.arc(r, t, radius, -Math.PI*0.5,            0, false);  // 右上
    canvas.context.arc(r, b, radius,            0,  Math.PI*0.5, false);  // 右下
    canvas.context.arc(l, b, radius,  Math.PI*0.5,      Math.PI, false);  // 左下
    canvas.context.closePath();
    if(isFill)canvas.context.fill();else canvas.context.stroke();
};


window.onload = function() {
    game = new Game();
    game.fps=30;
	game.input.touch={};
	game.preload("piano/do1.mp3",
		"piano/do1s.mp3",
		"piano/re.mp3",
		"piano/res.mp3",
		"piano/mi.mp3",
		"piano/fa.mp3",
		"piano/fas.mp3",
		"piano/so.mp3",
		"piano/sos.mp3",
		"piano/ra.mp3",
		"piano/ras.mp3",
		"piano/si.mp3",
		"piano/do2.mp3",
		"images/chara0.png",
		"images/chara5.png",
		"images/chara6.png",
		"images/map1.png");
    game.onload = function() {
	var scene = game.rootScene;

	/*
	 *鍵盤
	 */
	Kenbans= {
            do1:new Sprite(SPRITE_WIDTH, SPRITE_HEIGHT),
            do1s:new Sprite(SPRITE_WIDTH, ~~SPRITE_HEIGHT/2),
            re:new Sprite(SPRITE_WIDTH, SPRITE_HEIGHT),
            res:new Sprite(SPRITE_WIDTH, ~~SPRITE_HEIGHT/2),
            mi:new Sprite(SPRITE_WIDTH, SPRITE_HEIGHT),
            fa:new Sprite(SPRITE_WIDTH, SPRITE_HEIGHT),
            fas:new Sprite(SPRITE_WIDTH, ~~SPRITE_HEIGHT/2),
            so:new Sprite(SPRITE_WIDTH, SPRITE_HEIGHT),
            sos:new Sprite(SPRITE_WIDTH, ~~SPRITE_HEIGHT/2),
            ra:new Sprite(SPRITE_WIDTH, SPRITE_HEIGHT),
            ras:new Sprite(SPRITE_WIDTH, ~~SPRITE_HEIGHT/2),
            si:new Sprite(SPRITE_WIDTH, SPRITE_HEIGHT),
            do2:new Sprite(SPRITE_WIDTH, SPRITE_HEIGHT),
            name:["do1","re","mi","fa","so","ra","si","do2"],
            names:["do1s","res","","fas","sos","ras"],
            namej:["ド↓","レ","ミ","ファ","ソ","ラ","シ","ド↑"],
            namesj:["ド♯","レ♯","","ファ♯","ソ♯","ラ♯"],
            n:[],
            nn:["do1","do1s","re","res","mi","fa","fas","so","sos","ra","ras","si","do2"],
            KL:['A','W','S','E','D','F','T','G','Y','H','U','J','K']
        };

	for(var i=0;i<8;i++){
        sprite=Kenbans[Kenbans.name[i]];
        sprite.image = new Surface(SPRITE_WIDTH+1, SPRITE_HEIGHT+1);
        // canvas 描画
        sprite.image.context.fillStyle = "white";
        sprite.image.context.fillRect(0, 0, SPRITE_WIDTH, SPRITE_HEIGHT);
        sprite.image.context.lineWidth=4;
        sprite.image.context.strokeStyle = "black";
        sprite.image.context.strokeRect(0, 0, SPRITE_WIDTH, SPRITE_HEIGHT);

        sprite.x=i*SPRITE_WIDTH;
        sprite.y=SPRITE_HEIGHT*2;
        sprite.otoname=Kenbans.namej[i];
        sprite.sepath=SE_PATH[Kenbans.name[i]];
        sprite.ontouchstart=function(){
            this.image.context.fillStyle = "blue";
            this.image.context.fillRect(0, 0, SPRITE_WIDTH, SPRITE_HEIGHT);
            this.image.context.strokeRect(0, 0, SPRITE_WIDTH, SPRITE_HEIGHT);
        	game.assets[this.sepath].clone().play();
        	ensou[ensou.length]=this.number;
        	for(var i=0;i<gakuhus.length;i++){
        		for(var j=0;j<ensou.length-gakuhus[i].s.length+1;j++){
        			if(ensou.slice(j,j+gakuhus[i].s.length).join()===gakuhus[i].s.join()){
        				isMagicActive[i]=true;
        			}
        		}
        	}
        };

        sprite.ontouchend=function(){
            this.image.context.fillStyle = "white";
            this.image.context.fillRect(0, 0, SPRITE_WIDTH, SPRITE_HEIGHT);
            this.image.context.strokeRect(0, 0, SPRITE_WIDTH, SPRITE_HEIGHT);
        };

        sprite.setRed=function(){
            this.image.context.fillStyle = "red";
            this.image.context.fillRect(0, 0, SPRITE_WIDTH, SPRITE_HEIGHT);
            this.image.context.strokeRect(0, 0, SPRITE_WIDTH, SPRITE_HEIGHT);
        }
        sprite.onenterframe=function(){
        	if(game.input[this.key+'buttondown'])this.ontouchstart();
        	else if(game.input[this.key+'buttonup'])this.ontouchend();
        }
    }
    for(var i=0;i<7;i++){
        if(Kenbans.names[i]){
            sprite=Kenbans[Kenbans.names[i]];
            sprite.image =  new Surface(SPRITE_WIDTH, ~~SPRITE_HEIGHT/2);

            // canvas 描画
            sprite.image.context.fillStyle = "black";
            sprite.image.context.fillRect(~~SPRITE_WIDTH*0.1, 0, SPRITE_WIDTH*0.8, ~~SPRITE_HEIGHT/2);

            sprite.x=i*SPRITE_WIDTH+SPRITE_WIDTH/2;
            sprite.y=SPRITE_HEIGHT*2;
            sprite.otoname=Kenbans.namesj[i];
            sprite.sepath=SE_PATH[Kenbans.names[i]];
            sprite.ontouchstart=function(){
            	this.image.context.fillStyle="navy";
            	this.image.context.fillRect(~~SPRITE_WIDTH*0.1, 0, SPRITE_WIDTH*0.8, ~~SPRITE_HEIGHT/2);
            	game.assets[this.sepath].clone().play();
            	ensou[ensou.length]=this.number;
            	//すべての楽譜に対して演奏があってるか判定
            	for(var i=0;i<gakuhus.length;i++){
            		for(var j=0;j<ensou.length-gakuhus[i].s.length+1;j++){
            			if(ensou.slice(j,j+gakuhus[i].s.length).join()===gakuhus[i].s.join()){
            				isMagicActive[i]=true;
            			}
            		}
            	}
            };
            sprite.ontouchend=function(){
            	this.image.context.fillStyle="black";
            	this.image.context.fillRect(~~SPRITE_WIDTH*0.1, 0, SPRITE_WIDTH*0.8, ~~SPRITE_HEIGHT/2);
            };

            sprite.setRed=function(){
            	this.image.context.fillStyle="maroon";
            	this.image.context.fillRect(~~SPRITE_WIDTH*0.1, 0, SPRITE_WIDTH*0.8, ~~SPRITE_HEIGHT/2);
            }

            sprite.onenterframe=function(){
            	if(game.input[this.key+'buttondown'])this.ontouchstart();
            	else if(game.input[this.key+'buttonup'])this.ontouchend();
            }
        }
    }

    Kenbans.ks=function(k){return k.ontouchstart;};
    Kenbans.ke=function(k){return k.ontouchend;};

    for(var i=0;i<13;i++){
    	Kenbans.n[i]=Kenbans[Kenbans.nn[i]];
    	Kenbans.n[i].number=i;
    	Kenbans.n[i].key=Kenbans.KL[i];
    	game.keybind(Kenbans.KL[i].charCodeAt(0) , Kenbans.KL[i]);
    	game.on(Kenbans.KL[i]+'buttondown' ,function(e){game.input[e.type]=true;});
    	game.on(Kenbans.KL[i]+'buttonup' ,function(e){game.input[e.type]=true;});
    }


    game.on('exitframe',function(){
    	for(var i=0;i<13;i++){
   	    	game.input[Kenbans.KL[i]+'buttondown']=false;
   	    	game.input[Kenbans.KL[i]+'buttonup']=false;
   	    }
		game.input.touch.start   =false;
		game.input.touch.leftupstart   =false;
		game.input.touch.upstart       =false;
		game.input.touch.rightupstart  =false;
		game.input.touch.leftstart     =false;
		game.input.touch.centerstart   =false;
		game.input.touch.rightstart    =false;
		game.input.touch.leftdownstart =false;
		game.input.touch.downstart     =false;
		game.input.touch.rightdownstart=false;
	});

    game.replaceScene(TitleScene());

    };


    game.start();
};